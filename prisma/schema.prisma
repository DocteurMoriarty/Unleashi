generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") 
}

model User {
  id              Int            @id @default(autoincrement())
  username        String         @unique
  email           String         @unique
  password        String
  createdAt       DateTime       @default(now())
  topics          Topic[]        @relation("UserTopics")
  messages        Message[]      @relation("UserMessages")
  subscriptions   Subscription[]  @relation("UserSubscriptions") // Les abonnements que cet utilisateur a créés
  subscribedTo    Subscription[]  @relation("UserSubscribedTo") // Les abonnements de cet utilisateur
}

model Topic {
  id        Int      @id @default(autoincrement())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    Int
  User      User     @relation("UserTopics", fields: [userId], references: [id])
  messages  Message[]
}

model Message {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now())
  userId    Int
  topicId   Int

  User      User     @relation("UserMessages", fields: [userId], references: [id])
  Topic     Topic    @relation(fields: [topicId], references: [id])
}

model Subscription {
  id               Int      @id @default(autoincrement())
  subscriberId     Int
  subscribedToId   Int
  createdAt       DateTime @default(now())

  Subscriber      User @relation("UserSubscriptions", fields: [subscriberId], references: [id])
  SubscribedTo    User @relation("UserSubscribedTo", fields: [subscribedToId], references: [id])
}
